openapi: 3.0.3
info:
  title: AI Lead Scoring Service
  description: |
    Microservice for intelligent lead scoring using machine learning.
    
    This service analyzes lead behavior, form submissions, and interaction history
    to provide real-time scoring and categorization of sales leads.
  version: 1.0.0
  contact:
    name: CRM Development Team
    email: dev@crm-system.com

servers:
  - url: http://localhost:8001
    description: Local development server
  - url: https://api.crm-system.com/ai-lead
    description: Production server

paths:
  /health:
    get:
      summary: Health Check
      description: Returns the health status of the AI Lead service
      operationId: healthCheck
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  service:
                    type: string
                    example: "ai-lead"
                required:
                  - status
                  - service

  /api/ai/lead/score:
    post:
      summary: Score Lead
      description: |
        Analyze and score a lead based on behavioral data, form submissions,
        and interaction history. Returns a score from 0-1 with confidence level
        and top contributing features.
      operationId: scoreLead
      tags:
        - Lead Scoring
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LeadScoreRequest'
            examples:
              high_intent_lead:
                summary: High Intent Lead
                description: Example of a lead with high purchase intent
                value:
                  source: "website"
                  channel: "organic_search"
                  pageViews: 10
                  pages: ["/pricing", "/demo", "/contact"]
                  timeOnSite: 600
                  formFields:
                    - name: "company"
                      value: "Tech Corp"
                      type: "text"
                    - name: "email"
                      value: "john@techcorp.com"
                      type: "email"
                  lastMessages:
                    - "Need enterprise pricing"
                    - "When can we schedule a demo?"
                  historyInteractions:
                    - type: "email_open"
                      timestamp: "2024-01-01T10:00:00Z"
                      metadata:
                        campaign: "product_launch"
              minimal_lead:
                summary: Minimal Lead Data
                description: Example with minimal required fields
                value:
                  source: "email"
                  channel: "newsletter"
                  pageViews: 1
                  pages: []
                  timeOnSite: 30
                  formFields: []
                  lastMessages: []
                  historyInteractions: []
      responses:
        '200':
          description: Lead scoring completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeadScoreResponse'
              examples:
                hot_lead:
                  summary: Hot Lead Result
                  value:
                    data:
                      score: 0.85
                      confidence: 0.92
                      category: "hot"
                      top_features:
                        - "pricing_page_visit"
                        - "high_page_views"
                        - "demo_page_visit"
                        - "long_session_duration"
                    error: null
                warm_lead:
                  summary: Warm Lead Result
                  value:
                    data:
                      score: 0.55
                      confidence: 0.78
                      category: "warm"
                      top_features:
                        - "medium_page_views"
                        - "form_submission"
                    error: null
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    LeadScoreRequest:
      type: object
      required:
        - source
        - channel
        - pageViews
        - pages
        - timeOnSite
        - formFields
        - lastMessages
        - historyInteractions
      properties:
        source:
          type: string
          description: Traffic source
          enum: ["website", "email", "social", "referral", "direct"]
          example: "website"
        channel:
          type: string
          description: Marketing channel
          enum: ["organic_search", "paid_search", "social_media", "email_campaign", "referral", "direct"]
          example: "organic_search"
        pageViews:
          type: integer
          minimum: 0
          description: Number of pages viewed in session
          example: 5
        pages:
          type: array
          items:
            type: string
          description: List of pages visited
          example: ["/pricing", "/features", "/contact"]
        timeOnSite:
          type: integer
          minimum: 0
          description: Time spent on site in seconds
          example: 300
        formFields:
          type: array
          items:
            $ref: '#/components/schemas/FormField'
          description: Form fields submitted by the lead
        lastMessages:
          type: array
          items:
            type: string
          description: Recent messages or inquiries from the lead
          example: ["Interested in enterprise solution"]
        historyInteractions:
          type: array
          items:
            $ref: '#/components/schemas/HistoryInteraction'
          description: Historical interaction data

    FormField:
      type: object
      required:
        - name
        - value
        - type
      properties:
        name:
          type: string
          description: Field name
          example: "company"
        value:
          type: string
          description: Field value
          example: "Tech Corp"
        type:
          type: string
          description: Field type
          enum: ["text", "email", "tel", "number", "select", "textarea"]
          example: "text"

    HistoryInteraction:
      type: object
      required:
        - type
        - timestamp
      properties:
        type:
          type: string
          description: Type of interaction
          enum: ["email_open", "email_click", "form_submit", "page_view", "download", "webinar_attend"]
          example: "email_open"
        timestamp:
          type: string
          format: date-time
          description: When the interaction occurred
          example: "2024-01-01T10:00:00Z"
        metadata:
          type: object
          additionalProperties: true
          description: Additional interaction metadata
          example:
            campaign: "product_launch"
            email_subject: "New Product Features"

    LeadScoreResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            score:
              type: number
              minimum: 0
              maximum: 1
              description: Lead score from 0 to 1
              example: 0.85
            confidence:
              type: number
              minimum: 0
              maximum: 1
              description: Confidence level of the prediction
              example: 0.92
            category:
              type: string
              enum: ["hot", "warm", "cold"]
              description: Lead category based on score
              example: "hot"
            top_features:
              type: array
              items:
                type: string
              description: Most important features contributing to the score
              example: ["pricing_page_visit", "high_page_views"]
          required:
            - score
            - confidence
            - category
            - top_features
        error:
          type: string
          nullable: true
          description: Error message if any
          example: null
      required:
        - data
        - error

    ValidationError:
      type: object
      properties:
        detail:
          type: array
          items:
            type: object
            properties:
              loc:
                type: array
                items:
                  anyOf:
                    - type: string
                    - type: integer
                description: Location of the error
              msg:
                type: string
                description: Error message
              type:
                type: string
                description: Error type
            required:
              - loc
              - msg
              - type

    ErrorResponse:
      type: object
      properties:
        data:
          type: object
          nullable: true
          example: null
        error:
          type: string
          description: Error message
          example: "Internal server error occurred"
      required:
        - data
        - error

tags:
  - name: Health
    description: Service health monitoring
  - name: Lead Scoring
    description: Lead scoring and analysis operations